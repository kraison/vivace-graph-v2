;;;;; -*- mode: common-lisp;   common-lisp-style: modern;    coding: utf-8; -*-
;;;;;
;;;;;

(in-package :vivace-graph-v2)

(defun random-triple ()
                   (flet ((random-node ()
                            (arnesi:random-string (random 30))))
                     (make-triple 
                       :subject (random-node)
                       :predicate (random-node)
                       :object (random-node))))

(defun random-relation (t1 t2)
                   (flet ((random-constituent () 
                              (elt '(#'subject #'predicate #'object) 
                                (random 3))))
                     (make-triple 
                       :subject (funcall (random-constituent) t1)
                       :predicate (funcall (random-constituent) t2)
                       :object (funcall (random-constituent) (random-triple)))))

(defun random-graph (size)
                   (loop for i from 1 to size appending
                     (let ((a (random-triple))
                            (b (random-triple)))
                       (flet ((a-node-of (trip)
                                (elt (list (subject trip) (predicate trip) (object trip))
                                  (random 3))))
                         (list a b (make-triple :subject (a-node-of a) :predicate (a-node-of b)
                                     :object (a-node-of (random-triple))))))))

(defun random-store (size)
                   (loop for i from 1 to size
                     with chunk = 10
                     appending (random-graph chunk)))

(defun stress-test (size) 
                   (let ((x (random-store size)) y)
                     (time
                       (with-graph-transaction (*store*)
                         (dolist (i x)
                           (add-triple (subject i) (predicate i) (object i)))))
                     (time
                       (with-graph-transaction (*store*)
                         (setq y (get-triples-list))))
                     (set-difference x y :test #'triple-equal)))


#|




measuring PROFILE overhead..done
  seconds  |     gc     |     consed    |    calls    |  sec/call  |  name  
-----------------------------------------------------------------
    22.255 |      0.041 |    29,782,240 | 111,310,546 |  0.0000002 | TRIPLE-EQUAL
    10.041 |      0.034 |     8,438,704 | 222,712,526 |  0.0000000 | ID
     8.052 |      5.907 |   482,614,640 |     131,682 |   0.000061 | DESCEND-HT
     7.529 |      5.658 |   290,967,680 |       2,762 |   0.002726 | SERIALIZE-ACTION
     4.744 |      2.490 |   241,200,976 |      57,404 |   0.000083 | CURSOR-VALUE
     4.133 |      2.165 |   151,735,184 |      24,240 |   0.000171 | LOCK-PATTERN
     2.441 |      1.050 |   477,294,928 |      30,371 |   0.000080 | SERIALIZE
     1.867 |      0.831 |   145,130,224 |     225,000 |   0.000008 | FIND-OR-CREATE-HT
     1.496 |      1.101 |   118,220,160 |      24,250 |   0.000062 | PRINT-TRANSACTION
     0.616 |      0.344 |    22,506,800 |           1 |   0.615709 | RECORD-TX
     0.483 |      0.024 |    37,312,256 |           2 |   0.241668 | GET-TRIPLES-LIST
     0.429 |      0.285 |    62,394,624 |      24,240 |   0.000018 | UNLOCK-PATTERN
     0.409 |      0.376 |    53,572,480 |      63,000 |   0.000006 | ADD-TO-INDEX
     0.334 |      0.294 |     3,639,424 |      15,240 |   0.000022 | RELEASE-POOL-LOCK
     0.318 |      0.000 |       491,520 |      24,240 |   0.000013 | ACQUIRE-WRITE-LOCK
     0.261 |      0.067 |     7,504,656 |      78,962 |   0.000003 | INTERN-SPOG
     0.148 |      0.574 |    75,120,608 |      29,687 |   0.000005 | GET-TRIPLE-BY-ID
     0.147 |      0.047 |    14,427,808 |      18,004 |   0.000008 | PRINT-TRIPLE
     0.144 |      0.000 |       917,792 |      15,240 |   0.000009 | GET-POOL-LOCK
     0.121 |      0.095 |    20,304,944 |      87,960 |   0.000001 | NEXT-IN-QUEUE?
     0.107 |      0.000 |       815,600 |     103,200 |   0.000001 | EMPTY-QUEUE?
     0.103 |      0.000 |    23,216,672 |      24,240 |   0.000004 | RELEASE-WRITE-LOCK
     0.087 |      0.000 |    56,036,768 |      51,168 |   0.000002 | GET-FROM-INDEX
     0.074 |      0.043 |     1,847,008 |     157,841 |  0.0000005 | MAIN-IDX
     0.064 |      0.000 |    15,725,088 |           2 |   0.031999 | FETCH-ALL-LEAVES
     0.057 |      0.000 |       308,352 |      30,480 |   0.000002 | LOCK-POOL
     0.057 |      0.023 |     6,264,544 |      51,167 |   0.000001 | MAKE-INDEX-CURSOR
     0.051 |      0.000 |     1,173,648 |     127,444 |  0.0000004 | LOCKS
     0.046 |      0.000 |       454,336 |      13,805 |   0.000003 | SERIALIZE-INTEGER
     0.046 |      0.000 |       196,608 |      15,240 |   0.000003 | ENQUEUE
     0.037 |      0.000 |       326,512 |      30,479 |   0.000001 | DELETED?
     0.025 |      0.000 |       624,496 |      57,480 |  0.0000004 | QUEUE-FRONT
     0.024 |      0.000 |        98,304 |      15,241 |   0.000002 | %GETTIMEOFDAY
     0.023 |      0.000 |     4,026,816 |       9,000 |   0.000003 | RANDOM-TRIPLE
     0.023 |      0.000 |       917,296 |      15,241 |   0.000001 | GETTIMEOFDAY
     0.017 |      0.000 |     5,152,656 |      24,240 |   0.000001 | LOCK-UNUSED?
     0.011 |      0.000 |     1,039,568 |      24,240 |  0.0000005 | DEQUEUE
     0.011 |      0.000 |       131,088 |      42,244 |  0.0000003 | SUBJECT
     0.010 |      0.000 |     1,833,376 |      21,000 |  0.0000005 | MAKE-TRIPLE
     0.007 |      0.000 |             0 |      42,244 |  0.0000002 | OBJECT
     0.006 |      0.000 |             0 |      15,239 |  0.0000004 | INDEXED-PREDICATES
     0.005 |      0.000 |     1,080,944 |      24,240 |  0.0000002 | ENQUEUE-LOCK
     0.005 |      0.000 |             0 |      24,250 |  0.0000002 | TX-ID
     0.005 |      0.000 |             0 |      43,673 |  0.0000001 | DELETE-FROM-INDEX
     0.004 |      0.000 |       163,840 |      57,483 |  0.0000001 | PREDICATE
     0.003 |      0.000 |       155,040 |           4 |   0.000749 | MAKE-UUID
     0.002 |      0.000 |     1,179,344 |         300 |   0.000008 | RANDOM-GRAPH
     0.002 |      0.000 |             0 |      15,239 |  0.0000001 | INDEX-PREDICATE?
     0.001 |      0.000 |             0 |           1 |   0.000996 | SET-DIRTY
     0.000 |      0.000 |       229,376 |           2 |   0.000000 | ROLLBACK-TX
     0.000 |      0.093 |             0 |           4 |   0.000000 | RELEASE-ALL-LOCKS
     0.000 |      0.000 |             0 |           1 |   0.000000 | TX-QUEUE
     0.000 |      0.000 |             0 |           1 |   0.000000 | INDEX-TEST
     0.000 |      0.000 |        32,768 |       9,000 |   0.000000 | ENQUEUE-FRONT
     0.000 |      0.000 |             0 |           1 |   0.000000 | INDEX-TABLE
     0.000 |      0.000 |             0 |           1 |   0.000000 | STRESS-TEST
     0.000 |      0.000 |             0 |           1 |   0.000000 | DUMP-TRANSACTION
     0.000 |      0.000 |        32,752 |           4 |   0.000000 | MAKE-TRANSACTION
     0.000 |      0.023 |    57,090,784 |           4 |   0.000000 | EXECUTE-TX
     0.000 |      0.000 |       523,120 |       9,000 |   0.000000 | UNLOCK-TRIPLE
     0.000 |      0.000 |             0 |       6,239 |   0.000000 | %DEINDEX-TRIPLE
     0.000 |      0.000 |             0 |           2 |   0.000000 | LOCATION
     0.000 |      0.000 |             0 |           1 |   0.000000 | INDEX-NAME
     0.000 |      0.000 |       229,344 |       9,000 |   0.000000 | INDEX-TRIPLE
     0.000 |      0.000 |             0 |       9,000 |   0.000000 | LOCK-TRIPLE
     0.000 |      0.000 |             0 |           1 |   0.000000 | INDEX-LOCKS
     0.000 |      0.000 |             0 |      48,480 |   0.000000 | STORE-NAME
     0.000 |      0.000 |        98,304 |           1 |   0.000000 | RANDOM-STORE
     0.000 |      0.000 |             0 |           1 |   0.000000 | LOG-MAILBOX
     0.000 |      0.000 |             0 |           2 |   0.000000 | GET-TRIPLES
     0.000 |      0.000 |             0 |      15,240 |   0.000000 | LOOKUP-TRIPLE
     0.000 |      0.000 |             0 |       9,000 |   0.000000 | CF
     0.000 |      0.000 |     5,271,408 |      15,240 |   0.000000 | ADD-TRIPLE
-----------------------------------------------------------------
    66.882 |     21.565 | 2,429,853,408 | 336,042,008 |            | Total

estimated total profiling overhead: 603.53 seconds
overhead estimation parameters:
  1.e-8s/call, 1.796e-6s total profiling, 8.1e-7s internal profiling

These functions were not called:
 %ADD-TRIPLE %DELETE-TRIPLE %INDEX-TRIPLE %MAKE-FUNCTOR %MAKE-LOCK-POOL %SET-TRIPLE-CF %UNDELETE-TRIPLE /=/2 </2 <=/2 =/2 ==/2 >/2 >=/2 ?
 ACQUIRE-HASH-TABLE-LOCK ACQUIRE-READ-LOCK ADD-CLAUSE ADD-FUNCTOR-CLAUSE ADD-TO-DELETE-QUEUE ADD-TO-INDEX-QUEUE ADD-TO-TEXT-INDEX ADJUST-BELIEF ANON-VARS-IN
 ANONYMOUS-VARIABLES-IN ANONYMOUS? ARGS ASSERT/1 BAGOF/3 BASIC-CONCURRENCY-1 BASIC-CONCURRENCY-2 BELIEF->ENGLISH BELIEF-FACTOR BIND-NEW-VARIABLES
 BIND-UNBOUND-VARS BIND-VARIABLES-IN BINDING-VAL BOUND-P CALL/1 CERTAINTY-FACTOR-P CERTAINTY-FACTOR/2 CF->ENGLISH CF-AND CF-COMBINE CF-OR CHANGE-LOCK-POOL-SIZE
 CHANGE-STORE CHECK-INDEX CLAUSE-BODY CLAUSE-HEAD CLAUSES-WITH-ARITY CLEAR-GRAPH CLEAR-SNAPSHOTS CLEAR-TRIPLE-STORE CLEAR-TX-LOG CLOSE-TRIPLE-STORE COMPILE-ARG
 COMPILE-BODY COMPILE-CALL COMPILE-CLAUSE COMPILE-FUNCTOR COMPILE-IF COMPILE-UNIFY COMPILE-UNIFY-VARIABLE CONJUNCT-CF CONTINUE-P COPY-FUNCTOR COPY-INDEX
 COPY-INDEX-CURSOR COPY-LOCK-POOL COPY-QUEUE COPY-RW-LOCK COPY-TRANSACTION COPY-TRIPLE COPY-VAR CREATE-TRIPLE-STORE CURSOR-CLOSE CURSOR-NEXT CURSOR-PREV
 DEFAULT-FUNCTOR? DELETE-FUNCTOR DELETE-INDEX-PATH (SETF DELETE-QUEUE) DELETE-QUEUE DELETE-TRIPLE DELETE-UNDELETE-TEST DEREF-COPY DEREF-EQUAL DEREF-EXP
 DESERIALIZE DESERIALIZE-ACTION DESERIALIZE-FILE DESERIALIZE-INTEGER DESERIALIZE-SEQUENCE DESERIALIZE-TRIPLE-SLOT DISABLE-NAMESPACE-READER DISPLAY-NAMESPACES
 DO-INDEXING DUMP-TRIPLES ENABLE-!-READER ENQUEUE-TRIPLE-FOR-INDEXING EXTEND-BINDINGS FAIL/0 FALSE-P FIND-ALL FIND-ANYWHERE FIND-IF-ANYWHERE
 FIND-NEWEST-SNAPSHOT FIND-TRANSACTIONS FLATTEN FOLLOW-BINDING (SETF FUNCTOR-CLAUSES) FUNCTOR-CLAUSES (SETF FUNCTOR-FN) FUNCTOR-FN (SETF FUNCTOR-LOCK)
 FUNCTOR-LOCK (SETF FUNCTOR-NAME) FUNCTOR-NAME FUNCTOR? GET-BINDING GET-FUNCTOR-FN GET-INDEX-RANGE GET-NAMESPACE GET-PROP GET-TABLE-TO-LOCK GRAPH GRAPH/2
 GREATER-THAN HAS-VARIABLE-P HASH-TABLE-KEYS IDX-EQUAL IF/2 IF/3 (SETF INDEX-CURSOR-INDEX) INDEX-CURSOR-INDEX INDEX-CURSOR-P (SETF INDEX-CURSOR-POINTER)
 INDEX-CURSOR-POINTER (SETF INDEX-CURSOR-VECTOR) INDEX-CURSOR-VECTOR (SETF INDEX-LOCKS) (SETF INDEX-NAME) INDEX-P INDEX-PREDICATE (SETF INDEX-QUEUE) INDEX-QUEUE
 (SETF INDEX-TABLE) (SETF INDEX-TEST) (SETF INDEXED-PREDICATES) IP-TO-STRING IS-FALSE?/2 IS-INVALID/1 IS-INVALID?/1 IS-TRUE?/2 IS-UNKNOWN?/2 IS-VALID/1
 IS-VALID?/1 IS/2 LENGTH=1 LISP/2 LISPP/1 LIST-INDEXED-PREDICATES LIST-TRIPLES LOAD-TRIPLES (SETF LOCATION) (SETF LOCK-LOCK) LOCK-LOCK (SETF LOCK-POOL)
 (SETF LOCK-POOL-ACQUIRED-LOCKS) LOCK-POOL-ACQUIRED-LOCKS (SETF LOCK-POOL-LOCK) LOCK-POOL-LOCK (SETF LOCK-POOL-QUEUE) LOCK-POOL-QUEUE (SETF LOCK-POOL-SIZE)
 LOCK-POOL-SIZE LOCK-POOL? (SETF LOCK-READERS) LOCK-READERS (SETF LOCK-SEMAPHORE) LOCK-SEMAPHORE (SETF LOCK-WAITQUEUE) LOCK-WAITQUEUE (SETF LOCK-WRITER)
 LOCK-WRITER (SETF LOCK-WRITER-QUEUE) LOCK-WRITER-QUEUE (SETF LOCKS) (SETF LOG-MAILBOX) (SETF LOGGER-THREAD) LOGGER-THREAD LOOKUP-FUNCTOR (SETF MAIN-IDX) MAKE-=
 MAKE-ANONYMOUS MAKE-ANONYMOUS-NODE MAKE-ANONYMOUS-NODE-NAME MAKE-EMPTY-QUEUE MAKE-FRESH-STORE MAKE-FUNCTOR MAKE-FUNCTOR-SYMBOL MAKE-HIERARCHICAL-INDEX
 MAKE-INDEX MAKE-LOCAL-TRIPLE-STORE MAKE-LOCK-POOL MAKE-PARAMETERS MAKE-QUEUE MAKE-RW-LOCK MAKE-SLOT-KEY MAKE-TEXT-IDX-KEY MAKE-UUID-TABLE MAP-CURSOR
 MAP-QUERY/3 MAYBE-ADD-UNDO-BINDINGS NAMESPACE-READER-ENABLED? NEW-INTERNED-SYMBOL NEW-SYMBOL NL/0 NOT/1 OBJECT/2 OPEN-TRIPLE-STORE (SETF PASS) PASS PERSISTENT?
 PREDICATE/2 PRINT-HASH PRINT-QUEUE PRINT-RW-LOCK PRINT-VAR PROLOG-COMPILE PROLOG-COMPILE-HELP PROLOG-COMPILE-NULL PROLOG-COMPILER-MACRO PROLOG-EQUAL
 PROLOG-IGNORE PROPER-LISTP Q-/3 Q-/4 (SETF QUEUE-ELEMENTS) QUEUE-ELEMENTS (SETF QUEUE-KEY) QUEUE-KEY (SETF QUEUE-LAST) QUEUE-LAST QUEUE-LENGTH QUEUE-P QUIT
 RANDOM-RELATION READ-NAMESPACE READ-NODE READ/1 RECALCULATE-CF REGEX-MATCH/2 REGISTER-NAMESPACE REIFY REIFY-RECURSIVE RELATION-ARITY RELEASE-HASH-TABLE-LOCK
 RELEASE-READ-LOCK (SETF REMOTE-HOST) REMOTE-HOST (SETF REMOTE-PORT) REMOTE-PORT REMOVE-FROM-TEXT-INDEX REPEAT/0 REPLACE-?-VARS REPLAY-TRANSACTIONS
 RESET-FUNCTOR REST2 RESTORE-TRIPLE-STORE RETRACT/1 REUSE-CONS ROLL-LOGFILE RW-LOCK? SELECT/2 SELF-CONS SERIALIZE-SEQUENCE SERIALIZE-TRIPLE-HELP SET-BINDING
 SET-CLEAN SET-FUNCTOR-FN SET-TRIPLE-CF SETOF/3 SHORTEN-NAMESPACE SHOW-PROLOG-VARS/2 SNAPSHOT SPLIT START-LOGGER STOP-LOGGER (SETF STORE-NAME) SUBJECT/2
 SXHASH-IDX SXHASH-UUID (SETF TEMPLATES) TEMPLATES TEST-INDEX TEST-SERIALIZER (SETF TEXT-IDX) TEXT-IDX TIMESTAMP? TRACE-PROLOG TRANSACTION? TRIGGER/1
 (SETF TRIPLE-CF) TRIPLE-CF TRIPLE-COUNT (SETF TRIPLE-DELETED?) TRIPLE-DELETED? (SETF TRIPLE-GRAPH) TRIPLE-GRAPH (SETF TRIPLE-ID) TRIPLE-ID TRIPLE-ID/2
 (SETF TRIPLE-OBJECT) TRIPLE-OBJECT (SETF TRIPLE-PERSISTENT?) TRIPLE-PERSISTENT? (SETF TRIPLE-PREDICATE) TRIPLE-PREDICATE TRIPLE-STORE? (SETF TRIPLE-SUBJECT)
 TRIPLE-SUBJECT TRIPLE? TRUE-P TRULY-DELETE-TRIPLE (SETF TX-ID) (SETF TX-LOCKS) TX-LOCKS (SETF TX-MAILBOX) TX-MAILBOX (SETF TX-QUEUE) (SETF TX-ROLLBACK)
 TX-ROLLBACK (SETF TX-STORE) TX-STORE (SETF TX-THREAD) TX-THREAD UNBOUND-VAR-P UNDELETE-TRIPLE UNDO-BINDINGS UNIFY UNINDEX-PREDICATE UNIQUE-FIND-ANYWHERE-IF
 UNKNOWN-P UNTRACE-PROLOG URI? USE-GRAPH (SETF USER) USER VALID-DATE?/1 VALID-PROLOG-QUERY? (SETF VAR-BINDING) VAR-BINDING (SETF VAR-NAME) VAR-NAME VAR-P VAR/1
 VARIABLE-P VARIABLES-IN WRITE/1
  seconds  |     gc     |     consed    |    calls    |  sec/call  |  name  
-----------------------------------------------------------------
    22.422 |      0.068 |    35,708,304 | 111,310,546 |  0.0000002 | TRIPLE-EQUAL
    10.041 |      0.034 |     8,438,704 | 222,712,526 |  0.0000000 | ID
     8.052 |      5.907 |   482,614,640 |     131,682 |   0.000061 | DESCEND-HT
     7.529 |      5.658 |   290,967,680 |       2,762 |   0.002726 | SERIALIZE-ACTION
     4.744 |      2.490 |   241,200,976 |      57,404 |   0.000083 | CURSOR-VALUE
     4.133 |      2.165 |   151,735,184 |      24,240 |   0.000171 | LOCK-PATTERN
     2.441 |      1.050 |   477,294,928 |      30,371 |   0.000080 | SERIALIZE
     1.867 |      0.831 |   145,130,224 |     225,000 |   0.000008 | FIND-OR-CREATE-HT
     1.496 |      1.101 |   118,220,160 |      24,250 |   0.000062 | PRINT-TRANSACTION
     0.616 |      0.344 |    22,506,800 |           1 |   0.615709 | RECORD-TX
     0.483 |      0.024 |    37,312,256 |           2 |   0.241668 | GET-TRIPLES-LIST
     0.429 |      0.285 |    62,394,624 |      24,240 |   0.000018 | UNLOCK-PATTERN
     0.409 |      0.376 |    53,572,480 |      63,000 |   0.000006 | ADD-TO-INDEX
     0.334 |      0.294 |     3,639,424 |      15,240 |   0.000022 | RELEASE-POOL-LOCK
     0.318 |      0.000 |       491,520 |      24,240 |   0.000013 | ACQUIRE-WRITE-LOCK
     0.261 |      0.067 |     7,504,656 |      78,962 |   0.000003 | INTERN-SPOG
     0.148 |      0.574 |    75,120,608 |      29,687 |   0.000005 | GET-TRIPLE-BY-ID
     0.147 |      0.047 |    14,427,808 |      18,004 |   0.000008 | PRINT-TRIPLE
     0.144 |      0.000 |       917,792 |      15,240 |   0.000009 | GET-POOL-LOCK
     0.121 |      0.095 |    20,304,944 |      87,960 |   0.000001 | NEXT-IN-QUEUE?
     0.107 |      0.000 |       815,600 |     103,200 |   0.000001 | EMPTY-QUEUE?
     0.103 |      0.000 |    23,216,672 |      24,240 |   0.000004 | RELEASE-WRITE-LOCK
     0.087 |      0.000 |    56,036,768 |      51,168 |   0.000002 | GET-FROM-INDEX
     0.074 |      0.043 |     1,847,008 |     157,841 |  0.0000005 | MAIN-IDX
     0.064 |      0.000 |    15,725,088 |           2 |   0.031999 | FETCH-ALL-LEAVES
     0.057 |      0.000 |       308,352 |      30,480 |   0.000002 | LOCK-POOL
     0.057 |      0.023 |     6,264,544 |      51,167 |   0.000001 | MAKE-INDEX-CURSOR
     0.051 |      0.000 |     1,173,648 |     127,444 |  0.0000004 | LOCKS
     0.046 |      0.000 |       454,336 |      13,805 |   0.000003 | SERIALIZE-INTEGER
     0.046 |      0.000 |       196,608 |      15,240 |   0.000003 | ENQUEUE
     0.037 |      0.000 |       326,512 |      30,479 |   0.000001 | DELETED?
     0.025 |      0.000 |       624,496 |      57,480 |  0.0000004 | QUEUE-FRONT
     0.024 |      0.000 |        98,304 |      15,241 |   0.000002 | %GETTIMEOFDAY
     0.023 |      0.000 |     4,026,816 |       9,000 |   0.000003 | RANDOM-TRIPLE
     0.023 |      0.000 |       917,296 |      15,241 |   0.000001 | GETTIMEOFDAY
     0.017 |      0.000 |     5,152,656 |      24,240 |   0.000001 | LOCK-UNUSED?
     0.011 |      0.000 |     1,039,568 |      24,240 |  0.0000005 | DEQUEUE
     0.011 |      0.000 |       131,088 |      42,244 |  0.0000003 | SUBJECT
     0.010 |      0.000 |     1,833,376 |      21,000 |  0.0000005 | MAKE-TRIPLE
     0.007 |      0.000 |             0 |      42,244 |  0.0000002 | OBJECT
     0.006 |      0.000 |             0 |      15,239 |  0.0000004 | INDEXED-PREDICATES
     0.005 |      0.000 |     1,080,944 |      24,240 |  0.0000002 | ENQUEUE-LOCK
     0.005 |      0.000 |             0 |      24,250 |  0.0000002 | TX-ID
     0.005 |      0.000 |             0 |      43,673 |  0.0000001 | DELETE-FROM-INDEX
     0.004 |      0.000 |       163,840 |      57,483 |  0.0000001 | PREDICATE
     0.003 |      0.000 |       155,040 |           4 |   0.000749 | MAKE-UUID
     0.002 |      0.000 |     1,179,344 |         300 |   0.000008 | RANDOM-GRAPH
     0.002 |      0.000 |             0 |      15,239 |  0.0000001 | INDEX-PREDICATE?
     0.001 |      0.000 |             0 |           1 |   0.000996 | SET-DIRTY
     0.000 |      0.000 |       229,376 |           2 |   0.000000 | ROLLBACK-TX
     0.000 |      0.093 |             0 |           4 |   0.000000 | RELEASE-ALL-LOCKS
     0.000 |      0.000 |             0 |           1 |   0.000000 | TX-QUEUE
     0.000 |      0.000 |             0 |           1 |   0.000000 | INDEX-TEST
     0.000 |      0.000 |        32,768 |       9,000 |   0.000000 | ENQUEUE-FRONT
     0.000 |      0.000 |             0 |           1 |   0.000000 | INDEX-TABLE
     0.000 |      0.078 |    14,787,392 |           1 |   0.000000 | STRESS-TEST
     0.000 |      0.000 |             0 |           1 |   0.000000 | DUMP-TRANSACTION
     0.000 |      0.000 |        32,752 |           4 |   0.000000 | MAKE-TRANSACTION
     0.000 |      0.023 |    57,090,784 |           4 |   0.000000 | EXECUTE-TX
     0.000 |      0.000 |       523,120 |       9,000 |   0.000000 | UNLOCK-TRIPLE
     0.000 |      0.000 |             0 |       6,239 |   0.000000 | %DEINDEX-TRIPLE
     0.000 |      0.000 |             0 |           2 |   0.000000 | LOCATION
     0.000 |      0.000 |             0 |           1 |   0.000000 | INDEX-NAME
     0.000 |      0.000 |       229,344 |       9,000 |   0.000000 | INDEX-TRIPLE
     0.000 |      0.000 |             0 |       9,000 |   0.000000 | LOCK-TRIPLE
     0.000 |      0.000 |             0 |           1 |   0.000000 | INDEX-LOCKS
     0.000 |      0.000 |             0 |      48,480 |   0.000000 | STORE-NAME
     0.000 |      0.000 |        98,304 |           1 |   0.000000 | RANDOM-STORE
     0.000 |      0.000 |             0 |           1 |   0.000000 | LOG-MAILBOX
     0.000 |      0.000 |             0 |           2 |   0.000000 | GET-TRIPLES
     0.000 |      0.000 |             0 |      15,240 |   0.000000 | LOOKUP-TRIPLE
     0.000 |      0.000 |             0 |       9,000 |   0.000000 | CF
     0.000 |      0.000 |     5,271,408 |      15,240 |   0.000000 | ADD-TRIPLE
-----------------------------------------------------------------
    67.049 |     21.670 | 2,450,566,864 | 336,042,008 |            | Total

estimated total profiling overhead: 603.53 seconds
overhead estimation parameters:
  1.e-8s/call, 1.796e-6s total profiling, 8.1e-7s internal profiling

These functions were not called:
 %ADD-TRIPLE %DELETE-TRIPLE %INDEX-TRIPLE %MAKE-FUNCTOR %MAKE-LOCK-POOL %SET-TRIPLE-CF %UNDELETE-TRIPLE /=/2 </2 <=/2 =/2 ==/2 >/2 >=/2 ?
 ACQUIRE-HASH-TABLE-LOCK ACQUIRE-READ-LOCK ADD-CLAUSE ADD-FUNCTOR-CLAUSE ADD-TO-DELETE-QUEUE ADD-TO-INDEX-QUEUE ADD-TO-TEXT-INDEX ADJUST-BELIEF ANON-VARS-IN
 ANONYMOUS-VARIABLES-IN ANONYMOUS? ARGS ASSERT/1 BAGOF/3 BASIC-CONCURRENCY-1 BASIC-CONCURRENCY-2 BELIEF->ENGLISH BELIEF-FACTOR BIND-NEW-VARIABLES
 BIND-UNBOUND-VARS BIND-VARIABLES-IN BINDING-VAL BOUND-P CALL/1 CERTAINTY-FACTOR-P CERTAINTY-FACTOR/2 CF->ENGLISH CF-AND CF-COMBINE CF-OR CHANGE-LOCK-POOL-SIZE
 CHANGE-STORE CHECK-INDEX CLAUSE-BODY CLAUSE-HEAD CLAUSES-WITH-ARITY CLEAR-GRAPH CLEAR-SNAPSHOTS CLEAR-TRIPLE-STORE CLEAR-TX-LOG CLOSE-TRIPLE-STORE COMPILE-ARG
 COMPILE-BODY COMPILE-CALL COMPILE-CLAUSE COMPILE-FUNCTOR COMPILE-IF COMPILE-UNIFY COMPILE-UNIFY-VARIABLE CONJUNCT-CF CONTINUE-P COPY-FUNCTOR COPY-INDEX
 COPY-INDEX-CURSOR COPY-LOCK-POOL COPY-QUEUE COPY-RW-LOCK COPY-TRANSACTION COPY-TRIPLE COPY-VAR CREATE-TRIPLE-STORE CURSOR-CLOSE CURSOR-NEXT CURSOR-PREV
 DEFAULT-FUNCTOR? DELETE-FUNCTOR DELETE-INDEX-PATH (SETF DELETE-QUEUE) DELETE-QUEUE DELETE-TRIPLE DELETE-UNDELETE-TEST DEREF-COPY DEREF-EQUAL DEREF-EXP
 DESERIALIZE DESERIALIZE-ACTION DESERIALIZE-FILE DESERIALIZE-INTEGER DESERIALIZE-SEQUENCE DESERIALIZE-TRIPLE-SLOT DISABLE-NAMESPACE-READER DISPLAY-NAMESPACES
 DO-INDEXING DUMP-TRIPLES ENABLE-!-READER ENQUEUE-TRIPLE-FOR-INDEXING EXTEND-BINDINGS FAIL/0 FALSE-P FIND-ALL FIND-ANYWHERE FIND-IF-ANYWHERE
 FIND-NEWEST-SNAPSHOT FIND-TRANSACTIONS FLATTEN FOLLOW-BINDING (SETF FUNCTOR-CLAUSES) FUNCTOR-CLAUSES (SETF FUNCTOR-FN) FUNCTOR-FN (SETF FUNCTOR-LOCK)
 FUNCTOR-LOCK (SETF FUNCTOR-NAME) FUNCTOR-NAME FUNCTOR? GET-BINDING GET-FUNCTOR-FN GET-INDEX-RANGE GET-NAMESPACE GET-PROP GET-TABLE-TO-LOCK GRAPH GRAPH/2
 GREATER-THAN HAS-VARIABLE-P HASH-TABLE-KEYS IDX-EQUAL IF/2 IF/3 (SETF INDEX-CURSOR-INDEX) INDEX-CURSOR-INDEX INDEX-CURSOR-P (SETF INDEX-CURSOR-POINTER)
 INDEX-CURSOR-POINTER (SETF INDEX-CURSOR-VECTOR) INDEX-CURSOR-VECTOR (SETF INDEX-LOCKS) (SETF INDEX-NAME) INDEX-P INDEX-PREDICATE (SETF INDEX-QUEUE) INDEX-QUEUE
 (SETF INDEX-TABLE) (SETF INDEX-TEST) (SETF INDEXED-PREDICATES) IP-TO-STRING IS-FALSE?/2 IS-INVALID/1 IS-INVALID?/1 IS-TRUE?/2 IS-UNKNOWN?/2 IS-VALID/1
 IS-VALID?/1 IS/2 LENGTH=1 LISP/2 LISPP/1 LIST-INDEXED-PREDICATES LIST-TRIPLES LOAD-TRIPLES (SETF LOCATION) (SETF LOCK-LOCK) LOCK-LOCK (SETF LOCK-POOL)
 (SETF LOCK-POOL-ACQUIRED-LOCKS) LOCK-POOL-ACQUIRED-LOCKS (SETF LOCK-POOL-LOCK) LOCK-POOL-LOCK (SETF LOCK-POOL-QUEUE) LOCK-POOL-QUEUE (SETF LOCK-POOL-SIZE)
 LOCK-POOL-SIZE LOCK-POOL? (SETF LOCK-READERS) LOCK-READERS (SETF LOCK-SEMAPHORE) LOCK-SEMAPHORE (SETF LOCK-WAITQUEUE) LOCK-WAITQUEUE (SETF LOCK-WRITER)
 LOCK-WRITER (SETF LOCK-WRITER-QUEUE) LOCK-WRITER-QUEUE (SETF LOCKS) (SETF LOG-MAILBOX) (SETF LOGGER-THREAD) LOGGER-THREAD LOOKUP-FUNCTOR (SETF MAIN-IDX) MAKE-=
 MAKE-ANONYMOUS MAKE-ANONYMOUS-NODE MAKE-ANONYMOUS-NODE-NAME MAKE-EMPTY-QUEUE MAKE-FRESH-STORE MAKE-FUNCTOR MAKE-FUNCTOR-SYMBOL MAKE-HIERARCHICAL-INDEX
 MAKE-INDEX MAKE-LOCAL-TRIPLE-STORE MAKE-LOCK-POOL MAKE-PARAMETERS MAKE-QUEUE MAKE-RW-LOCK MAKE-SLOT-KEY MAKE-TEXT-IDX-KEY MAKE-UUID-TABLE MAP-CURSOR
 MAP-QUERY/3 MAYBE-ADD-UNDO-BINDINGS NAMESPACE-READER-ENABLED? NEW-INTERNED-SYMBOL NEW-SYMBOL NL/0 NOT/1 OBJECT/2 OPEN-TRIPLE-STORE (SETF PASS) PASS PERSISTENT?
 PREDICATE/2 PRINT-HASH PRINT-QUEUE PRINT-RW-LOCK PRINT-VAR PROLOG-COMPILE PROLOG-COMPILE-HELP PROLOG-COMPILE-NULL PROLOG-COMPILER-MACRO PROLOG-EQUAL
 PROLOG-IGNORE PROPER-LISTP Q-/3 Q-/4 (SETF QUEUE-ELEMENTS) QUEUE-ELEMENTS (SETF QUEUE-KEY) QUEUE-KEY (SETF QUEUE-LAST) QUEUE-LAST QUEUE-LENGTH QUEUE-P QUIT
 RANDOM-RELATION READ-NAMESPACE READ-NODE READ/1 RECALCULATE-CF REGEX-MATCH/2 REGISTER-NAMESPACE REIFY REIFY-RECURSIVE RELATION-ARITY RELEASE-HASH-TABLE-LOCK
 RELEASE-READ-LOCK (SETF REMOTE-HOST) REMOTE-HOST (SETF REMOTE-PORT) REMOTE-PORT REMOVE-FROM-TEXT-INDEX REPEAT/0 REPLACE-?-VARS REPLAY-TRANSACTIONS
 RESET-FUNCTOR REST2 RESTORE-TRIPLE-STORE RETRACT/1 REUSE-CONS ROLL-LOGFILE RW-LOCK? SELECT/2 SELF-CONS SERIALIZE-SEQUENCE SERIALIZE-TRIPLE-HELP SET-BINDING
 SET-CLEAN SET-FUNCTOR-FN SET-TRIPLE-CF SETOF/3 SHORTEN-NAMESPACE SHOW-PROLOG-VARS/2 SNAPSHOT SPLIT START-LOGGER STOP-LOGGER (SETF STORE-NAME) SUBJECT/2
 SXHASH-IDX SXHASH-UUID (SETF TEMPLATES) TEMPLATES TEST-INDEX TEST-SERIALIZER (SETF TEXT-IDX) TEXT-IDX TIMESTAMP? TRACE-PROLOG TRANSACTION? TRIGGER/1
 (SETF TRIPLE-CF) TRIPLE-CF TRIPLE-COUNT (SETF TRIPLE-DELETED?) TRIPLE-DELETED? (SETF TRIPLE-GRAPH) TRIPLE-GRAPH (SETF TRIPLE-ID) TRIPLE-ID TRIPLE-ID/2
 (SETF TRIPLE-OBJECT) TRIPLE-OBJECT (SETF TRIPLE-PERSISTENT?) TRIPLE-PERSISTENT? (SETF TRIPLE-PREDICATE) TRIPLE-PREDICATE TRIPLE-STORE? (SETF TRIPLE-SUBJECT)
 TRIPLE-SUBJECT TRIPLE? TRUE-P TRULY-DELETE-TRIPLE (SETF TX-ID) (SETF TX-LOCKS) TX-LOCKS (SETF TX-MAILBOX) TX-MAILBOX (SETF TX-QUEUE) (SETF TX-ROLLBACK)
 TX-ROLLBACK (SETF TX-STORE) TX-STORE (SETF TX-THREAD) TX-THREAD UNBOUND-VAR-P UNDELETE-TRIPLE UNDO-BINDINGS UNIFY UNINDEX-PREDICATE UNIQUE-FIND-ANYWHERE-IF
 UNKNOWN-P UNTRACE-PROLOG URI? USE-GRAPH (SETF USER) USER VALID-DATE?/1 VALID-PROLOG-QUERY? (SETF VAR-BINDING) VAR-BINDING (SETF VAR-NAME) VAR-NAME VAR-P VAR/1
 VARIABLE-P VARIABLES-IN WRITE/1

|#

;;;;;
;; Local Variables:
;; indent-tabs: nil
;; outline-regexp: ";;[;]+"
;; End:
;;;;;
